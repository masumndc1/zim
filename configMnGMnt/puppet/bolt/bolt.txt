
...
... puppet bolt

... install module by puppet bolt
... you can create on file called bolt-project.yaml
...

❯ cat bolt-project.yaml
---
name: practise
format: json
apply-settings:
  evaltrace: true
  log_level: debug
  show_diff: true
  trace: true
color: true
modules:
- puppetlabs-stdlib
- mschuchard-extended_stdlib
- name: puppetlabs-apt
  version_requirement: 10.0.0

... now run
$ bolt module install
Installing project modules

Syncing modules from /Users/khuddin/Documents/github/puppet-bolt/Puppetfile to
/Users/khuddin/Documents/github/puppet-bolt/.modules
Generating type references

{"success":true,
"puppetfile":"/Users/khuddin/Documents/github/puppet-bolt/Puppetfile",
"moduledir":"/Users/khuddin/Documents/github/puppet-bolt/.modules"
}

... this will also generate a Puppetfile with following content:
... this file should not be edited manually.

❯ cat Puppetfile
# This Puppetfile is managed by Bolt. Do not edit.
# For more information, see https://pup.pt/bolt-modules

# The following directive installs modules to the managed moduledir.
moduledir '.modules'

mod 'pcfens/static_custom_facts', '0.3.2'
mod 'puppetlabs/stdlib', '9.7.0'
mod 'mschuchard/extended_stdlib', '1.2.1'

...
... you can also add module by following command:(any of them below)

$ bolt module install --force
$ bolt module add puppetlabs-apt

... you can now add apt in site.pp file.

❯ cat manifests/site.pp
#include apt

apt::keyring { 'puppetlabs-keyring.gpg':
  source => 'https://apt.puppetlabs.com/keyring.gpg',
}

... now run this against the cloud-test node which should
... generate a puppetlabs-keyring.gpg file in /etc/apt/keyrings folder

$ bolt apply manifests/site.pp -t cloud-test

... running a single command:
... puppet bolt can take parameters from ~/.ssh/config file

cat ~/.ssh/config
#Include /Users/khuddin/.colima/ssh_config

# Fig ssh integration. Keep at the bottom of this file.
Match all
  Include ~/.fig/ssh

#Host sys-alma9-dev1
Host sys-*-dev1
  ProxyCommand ssh -F ~/Documents/github/puppet-bolt/ssh.config -q masum@lap-macmini nc %h 22
  user masum
  IdentityFile ~/.ssh/id_ed25519

... then you can run bolt command against it

$ bolt command run 'uptime' -t ssh://masum@sys-alma9-dev1

... another way of configuring the settings:

$ cat ~/.ssh/config
Include /Users/khuddin/Documents/github/puppet-bolt/ssh_config

# Fig ssh integration. Keep at the bottom of this file.
Match all
  Include ~/.fig/ssh

Host *
  StrictHostKeyChecking no

... here in the include you define the ssh config file to use
... and the content of the /Users/khuddin/Documents/github/puppet-bolt/ssh_config
... can be following:

❯ cat ssh_config
# nice document on this
# https://www.cyberciti.biz/faq/create-ssh-config-file-on-linux-unix/
# add the content of this file at the end of your ~/.ssh/config file.

Host *
  StrictHostKeyChecking no

Host lap-macmini
  HostName <ip_address>
  User masum
  IdentityFile ~/.ssh/id_ed25519
# this will prevent following error
# Warning: Permanently added '' (ED25519) to the list of known hosts.
  StrictHostKeyChecking accept-new
  UserKnownHostsFile ~/.ssh/known_hosts

Host cloud-ubu
  HostName <ip_address>
  User masum
  IdentityFile ~/.ssh/id_ed25519
# this will prevent following error
# Warning: Permanently added '' (ED25519) to the list of known hosts.
  StrictHostKeyChecking accept-new
  UserKnownHostsFile ~/.ssh/known_hosts

Host sys*dev1
  HostName %h
  User masum
  IdentityFile ~/.ssh/id_ed25519
  ProxyJump lap-macmini
  StrictHostKeyChecking no

Host sys*dev6
  HostName %h
  User masum
  IdentityFile ~/.ssh/id_ed25519
  ProxyJump cloud-ubu
  StrictHostKeyChecking no


... if running bolt plan run exited with operation not permitted, then
... bolt should be run with sudo.

❯ sudo bolt plan run -v practise::pkg -t localhost
Starting: plan practise::pkg
Starting: install puppet and gather facts on localhost
Finished: install puppet and gather facts with 0 failures in 27.2 sec
Starting: apply catalog on localhost
Started on localhost...
Finished on localhost:
  Notice: /Stage[main]/Main/Apt::Keyring[puppetlabs-keyring.gpg]/
  File[/etc/apt/keyrings/puppetlabs-keyring.gpg]/ensure: defined content as '{mtime}2025-04-09 17:56:22 UTC'
  changed: 1, failed: 0, unchanged: 3 skipped: 0, noop: 0
Finished: apply catalog with 0 failures in 27.78 sec
Finished: plan practise::pkg in 54.99 sec
Finished on localhost:
  Notice: /Stage[main]/Main/Apt::Keyring[puppetlabs-keyring.gpg]/
  /File[/etc/apt/keyrings/puppetlabs-keyring.gpg]/ensure: defined content as '{mtime}2025-04-09 17:56:22 UTC'
  changed: 1, failed: 0, unchanged: 3 skipped: 0, noop: 0
Successful on 1 target: localhost
Ran on 1 target

- few things to remember:
- inherits does not fit in bolt plan.
- lookup/hiera is also possible in plan
- normal dependency which was available in Class -> Class is also possible here.
