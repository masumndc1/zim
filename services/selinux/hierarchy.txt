

... the file inside a directory will get the context by inheritance.
... also if a process runs another process then if not other said
... will have the same context inheritance.

[root@kube-node1 khabir]# ls -Z /var/www
drwxr-xr-x. root root system_u:object_r:httpd_sys_script_exec_t:s0 cgi-bin
drwxr-xr-x. root root system_u:object_r:httpd_sys_content_t:s0 html
[root@kube-node1 khabir]#

... therefore all the file in /var/www/html will have the httpd_sys_content
... but we have to keep one thing in our mind that if we copy one file
... to another location it will not preserve initial context. rather
... copied file will have targeted destination context.

[root@kube-node1 khabir]# cp /var/www/html/khabir/index.html /var/
[root@kube-node1 khabir]# ls -Z /var/index.html
-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /var/index.html
[root@kube-node1 khabir]#

... it is also possible to keep the context as like original like below

[root@kube-node1 # cp --preserve=context /var/www/html/khabir/index.html /var
[root@kube-node1 #
[root@kube-node1 # ls -Z /var/index.html
-rw-r--r--. root root unconfined_u:object_r:httpd_sys_content_t:s0 /var/index.html
[root@kube-node1 khabir]#

... but if we move the files from one location to another location
... then the original context will be preserved.

[root@kube-node1 khabir]# mv /var/index.html /etc
[root@kube-node1 khabir]# ls -Z /etc/index.html
-rw-r--r--. root root unconfined_u:object_r:var_t:s0   /etc/index.html
[root@kube-node1 khabir]#

... changing and restoring the selinux file context.

... all the file context are written in the following file.

[root@kube-node1 files]# pwd
/etc/selinux/targeted/contexts/files
[root@kube-node1 files]# cat file_contexts | wc -l
6060
[root@kube-node1 files]#

... now we are going to chaning the file context of /var/web
... after that we will check that by following.

[root@kube- ]# semanage fcontext --add --type httpd_sys_content_t "/var/web(/.*)?"
[root@kube- ]#

[root@kube-node1 files]# pwd
/etc/selinux/targeted/contexts/files
[root@kube-node1 files]# ls
file_contexts           file_contexts.homedirs.bin  file_contexts.subs
file_contexts.bin       file_contexts.local         file_contexts.subs_dist
file_contexts.homedirs  file_contexts.local.bin     media
[root@kube-node1 files]# cat file_contexts.local
# This file is auto-generated by libsemanage
# Do not edit directly.

/www/web(/.*)?    system_u:object_r:httpd_sys_content_t:s0
/var/web(/.*)?    system_u:object_r:httpd_sys_content_t:s0
[root@kube-node1 files]#

[root@kube-node1 files]# restorecon -v /var/web
restorecon reset /var/web context 
unconfined_u:object_r:var_t:s0->unconfined_u:object_r:httpd_sys_content_t:s0
[root@kube-node1 files]# 

[root@kube-node1 files]# matchpathcon -V /var/web
/var/web verified.
[root@kube-node1 files]#




